# Test Database Data

База данных эмулируется с помощью докер образа, который запускается
и настраивается в классe IntegrationTestBase c загрузкой схемы БД из файла
src/main/resources/schema.sql. После этого в БД загружаются некоторые тестовые данные,
которые могут быть полезны для проверки данных в тестах. Деплой и выключение тестового
окружения происходят в фикстурах @BeforeAll и @AfterAll.
Проверка тестовых данных производится матчерами с поддержкой регулярных выражений.
В тестах проверяются единичные строки, для работы с массивами данных следует 

### 1. Какие проверки на SID можно сделать? Написать сами проверки.
    В тестовом классe SidTest 4 проверки:
    1) на соответствие шаблону регулярного выражения 20 цифр/латинских букв правильного SID
    2) на несоответствие этому шаблону SID с длиной < 20
    3) на несоответствие этому шаблону SID с небуквенными символами 
    4) на выброс исключения БД при SID с длиной > 20

### 2. Провалидировать поле ИНН и вывести некорректные значения. По законодательству ИНН может состоять только из 10 или 12 цифр

    В тестовом классе InnTest 3 проверки:
    1) на соответствие шаблону регулярного выражения только из 10 или 12 цифр правильного INN
    2) на несоответствие этому шаблону INN с длиной 11
    3) на несоответствие этому шаблону INN с нечисловыми символами

### 8. Написать запрос, который выводит:
	- список стран (наименование страны)
	- количество контрагентов в этой стране
	Не выводить страны, в которых нет контрагентов.
```
SELECT COUNTRIES.name, COUNT(COUNTERPARTIES.sid)
from COUNTRIES Join COUNTERPARTIES on COUNTRIES.code=COUNTERPARTIES.country_cd
group by COUNTRIES.name
```

### 9. Написать запрос, к таблицам, который выводит следующие данные:
	- ИНН контрагента
	- короткое наименование контрагента
	- номер телефона. Если номер телефона начинается на 8, то изменить на +7. Если номер телефона не заполнен, то выводить значение 0
	- признак иностранного контрагента. Если иностранный контрагент - выводим значение Y, если российский контрагент - выводим значение N

```
SELECT COUNTERPARTIES.inn,
COUNTERPARTIES.short_name,
CASE
    WHEN COUNTERPARTIES.phone is NULL THEN '0'
    WHEN COUNTERPARTIES.phone LIKE '8%' THEN REGEXP_REPLACE(COUNTERPARTIES.phone, '^8', '+7')
    ELSE COUNTERPARTIES.phone
END AS phone,
CASE WHEN COUNTERPARTIES.COUNTRY_CD='RUS' THEN 'N' ELSE 'Y' END AS agent
from COUNTERPARTIES
```
